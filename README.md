# dwh_transport
## Проект по курсу DWH-аналитики в OTUS

### Как запустить проект:

Для развертывания проекта необходимо склонировать реппозиторий
с помощью команды git clone

Далее необходимо в двух разных терминалах перейти в папки 
airflow и metabase и выполнить команду docker compose up

Пользователь и пароль везде airflow.

Такде в airflow необходимо триггернуть DAG - load_transport_data.

В Метабейз необходимо зарегистрировать пользователя, установить соединение с БД Postgres.

Теперь можно проектировать дашборды.

## Бизнес-требование для проектирования DWH-хранилища данных

- Необходимо собрать все возможные данные о пассажиропотоках, основных транспортных узлах, о возможных сложных развязках и неровностях в одной базе данных для дальнейшей выгрузки отчетов и построения дашбордов для принятия решений о развитии автономного такси. (На начальном этапе это датасеты с сайта data.mos.ru, далее планируется подключение к OpenStreetMap и доп выгрузка данных с логов автономного городского транспорта).
Цели создания DWH:
- Централизованный источник достоверных данных для аналитики и отчетности;
- Ускорение процессов построения отчетов и аналитических витрин за счет единого формата данных (не нужно искать в интернете доп информацию, проверять, все доступно в текущем моменте);
- Снижение ручного труда по обработке данных из разных источников, вся агрегация производится автоматизированно.

### Источники:
Выгрузки с сайта data.mos.ru:

    • Автовокзалы и автостанции Москвы
    • Автозаправочные станции, реализующие топливо, несоответствующее установленным экологическим требованиям
    • Автозаправочные станции, реализующие топливо, соответствующее установленным экологическим требованиям
    • Аэропорты
    • Годовой пассажиропоток по всем видам общественного транспорта в городе Москве
    • Железнодорожные вокзалы Москвы
    • Зарядные станции для электромобилей
    • Парковки такси
    • Перехватывающие парковки
    • Платные парковки закрытого типа
    • Платные парковки на улично-дорожной сети
    • Реестр искусственных дорожных неровностей
    • Реестр транспортно-пересадочных узлов, требующих особого режима содержания

Модель БД – Звезда

Измерения (4, сущностей 7): 
1. Заправка (заправки, электрозарядки), 
2. Узлы, требующие доп режима (неровности, сложные узлы), 
3. Места стоянки, конечные пункты (парковки, транспортные узлы), 
4. Доп информация для аналитики (пассажиропоток)


Создается дополнительно единый справочник данных, по которому можно искать нужный айдишник (global_id). Это может быть заправка или аэропорт, жд вокзал и так далее. 
Практически в каждой таблице имеются данные о принадлежности к административному району – для агрегации и поска данных по районам. Далее можно создать общую витрину данных по районам.

### Разложения данных по слоям stage - ods - dds – datamart
Stage Layer:

Первичный прием сырого, необработанного файла из разных источников (в данном случае -  CSV). Файлы хранятся без изменений до дальнейшей обработки.

ODS (Operational Data Store):

Промежуточное хранилище, где данные приводятся к единому формату, очищаются, устраняются дубликаты и ошибки. Здесь нет сложных связей между сущностями — данные сохраняют свою транзакционную природу

DDS Layer (Data Warehouse):

Ядро хранилища, где реализована интеграция данных, построены факт и измерения. Данные нормализованы, обеспечены связи (foreign key), реализованы справочники и метаданные.

Datamart (Витрины данных):

Специализированные представления для аналитики и построения отчетов. Агрегация данных по районам и плотности тех или иных узлов/станций/заправок/парковок.

Структура:
![Структура БД](structure.png)